#!/opt/homebrew/bin/fish

source script/helpers.fish

print_heading "Checking for Rust/Cargo installation"

if not rustc -V
    echo "Rust is not installed. Installing..."
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
end

env sccache -V 2> /dev/null
if test $status -ne 0
	cargo install sccache
end

set cargo_packages \
	cargo-info \
	irust \
	bacon \
	ripgrep \
	bat \
	exa \
	rtx-cli \
	gitui \
	bob-nvim \
	wiki-tui \
	starship \
	porsmo

print_heading "Installing Cargo packages"

for i in $cargo_packages
	cargo install $i &| condense_cargo_output
end


print_heading "Symlinking Fish config"

ln -vsfh $PWD/fish/config.fish ~/.config/fish/config.fish
ln -vsfh $PWD/fish/functions/**.fish ~/.config/fish/functions/

print_heading "Symlinking Hammerspoon config"

ln -vsfh $PWD/hammerspoon/hammerspoon.lua ~/.hammerspoon/hammerspoon.lua

print_heading "Symlinking WezTerm config"

ln -vsfh $PWD/wezterm/wezterm.lua ~/.config/wezterm/wezterm.lua

print_heading "Symlinking NeoVim config"

mkdir -p ~/.config/nvim/lua/plugins
mkdir -p ~/.config/nvim/after/ftplugin

ln -vsfh $PWD/neovim/init.lua ~/.config/nvim/init.lua
ln -vsfh $PWD/neovim/plugins.lua ~/.config/nvim/lua/plugins.lua
ln -vsfh $PWD/neovim/plugins/*.lua ~/.config/nvim/lua/plugins/
ln -vsfh $PWD/neovim/ftplugin/*lua ~/.config/nvim/after/ftplugin/

echo -e "\nScript completed successfully ðŸŽ‰"

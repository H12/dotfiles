#!/opt/homebrew/bin/fish

argparse 's/skip-cargo' -- $argv

if not type -q fisher
	echo "Fisher is not installed. Installing"
	curl -sL https://git.io/fisher | source && fisher install jorgebucaran/fisher
else
	fisher -v
end

source script/helpers.fish

print_heading "Checking for Rust/Cargo installation"

if not type -q rustc
	print_heading "Rust is not installed. Installing"
	curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

	print_heading "Adding cargo binaries to path"
	set PATH ~/.cargo/bin $PATH
else
	rustc -V
end

if not type -q sccache
	cargo install sccache &| condense_cargo_output
else
	sccache -V
end

set cargo_packages \
	cargo-info \
	irust \
	bacon \
	fd-find \
	ripgrep \
	bat \
	exa \
	rtx-cli \
	gitui \
	bob-nvim \
	wiki-tui \
	starship \
	porsmo

print_heading "Installing Cargo packages"

for i in $cargo_packages
	cargo install $i &| condense_cargo_output
end


print_heading "Symlinking Fish config"

ln -vsfh $PWD/fish/config.fish ~/.config/fish/config.fish
ln -vsfh $PWD/fish/functions/**.fish ~/.config/fish/functions/

print_heading "Symlinking Hammerspoon config"

ln -vsfh $PWD/hammerspoon/hammerspoon.lua ~/.hammerspoon/hammerspoon.lua

print_heading "Symlinking WezTerm config"

ln -vsfh $PWD/wezterm/wezterm.lua ~/.config/wezterm/wezterm.lua

print_heading "Symlinking NeoVim config"

mkdir -p ~/.config/nvim/lua/plugins
mkdir -p ~/.config/nvim/after/ftplugin

ln -vsfh $PWD/neovim/init.lua ~/.config/nvim/init.lua
ln -vsfh $PWD/neovim/plugins.lua ~/.config/nvim/lua/plugins.lua
ln -vsfh $PWD/neovim/plugins/*.lua ~/.config/nvim/lua/plugins/
ln -vsfh $PWD/neovim/ftplugin/*lua ~/.config/nvim/after/ftplugin/

echo -e "\nScript completed successfully ðŸŽ‰"
